<style>
  #bgCanvas {
    background-color: rosybrown;
  }
  #gameCanvas {
    background-color: palevioletred;
    background-image: url(board.jpg);
    background-size: cover;
    background-position: center;
  }
</style>
<img id="bgImage" src="bg.jpg" />
<canvas id="bgCanvas"></canvas>
<canvas id="gameCanvas"></canvas>
<script>
  let { floor, random } = Math
  let gameContext = gameCanvas.getContext('2d')
  bgImage.onload = function () {
    console.log('check size')
    bgWidth = bgImage.naturalWidth
    bgHeight = bgImage.naturalHeight
    console.log(bgWidth, bgHeight)
    bgCanvas.width = bgWidth
    bgCanvas.height = bgHeight
    bgContext = bgCanvas.getContext('2d')
    bgContext.drawImage(bgImage, 0, 0, bgWidth, bgHeight)
    bgImage.remove()
    bgCanvas.remove()
    initGame()
  }
  function initGame() {
    unitSize = 20
    width = 450
    height = 350
    gameCanvas.width = width
    gameCanvas.height = height

    X = floor(width / unitSize)
    Y = floor(height / unitSize)

    board = []

    for (let y = 0; y < Y; y++) {
      board[y] = []
      for (let x = 0; x < X; x++) {
        board[y][x] = { alive: random() < 0.5 }
      }
    }
    // preview()
    draw()
  }
  function preview() {
    gameContext.putImageData(
      bgContext.getImageData(
        floor(bgWidth / 2 - width / 2),
        floor(bgHeight / 2 - height / 2),
        width,
        height,
      ),
      0,
      0,
    )
  }
  function draw() {
    for (let y = 0; y < Y; y++) {
      for (let x = 0; x < X; x++) {
        if (board[y][x].alive) {
           gameContext.fillStyle = '#ff000055'
           gameContext.fillRect(x * unitSize, y * unitSize, unitSize, unitSize)
        } else {
          // gameContext.fillStyle = 'black'
          // gameContext.fillRect(x * unitSize, y * unitSize, unitSize, unitSize)
          gameContext.putImageData(
            bgContext.getImageData(
              floor(bgWidth / 2 - width / 2) + x * unitSize,
              floor(bgHeight / 2 - height / 2) + y * unitSize,
              unitSize,
              unitSize,
            ),
            x * unitSize,
            y * unitSize,
          )
        }
      }
    }
  }
</script>
